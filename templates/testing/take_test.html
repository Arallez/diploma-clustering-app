{% extends 'base.html' %}
{% load static %}

{% block title %}Тест: {{ test.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/testing.css' %}">
{% endblock %}

{% block content %}
<div class="testing-section">
  <h1 class="testing-section__title--small">{{ test.title }}</h1>
  <p class="testing-section__subtitle">Группа: {{ test.group.name }}</p>
  
  <!-- Прогресс -->
  <div class="testing-progress">
    <div class="testing-progress__header">
      <span>Прогресс: {{ progress.attempted }} из {{ progress.total }} заданий ({{ progress.percent }}%)</span>
      <span>Осталось времени: <span id="timer" class="testing-timer" data-ends-at="{{ ends_at|date:'c' }}">—</span></span>
    </div>
    <div class="testing-progress__bar">
      <div class="testing-progress__fill" style="width: {{ progress.percent }}%"></div>
    </div>
  </div>

  <ul class="testing-task-list">
    {% for item in tasks_with_status %}
    <li>
      <div class="testing-task-list__row">
        {% if item.status == 'attempted' %}
          <span class="testing-task-status testing-task-status--done">✅</span>
        {% else %}
          <span class="testing-task-status testing-task-status--pending">◻️</span>
        {% endif %}
        <span class="testing-task-list__title">{{ item.task.title }}</span>
      </div>
      <a href="{% url 'tasks:challenge_detail' item.task.slug %}?test_attempt={{ attempt.pk }}" target="_blank" class="btn btn-outline btn-sm">Открыть →</a>
    </li>
    {% empty %}
    <li>В этом тесте нет заданий.</li>
    {% endfor %}
  </ul>

  <div class="testing-submit-wrap">
    <form action="{% url 'testing:submit_test' attempt.pk %}" method="post" id="submit-test-form">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary">Сдать тест</button>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/testing.js' %}"></script>
{% endblock %}
