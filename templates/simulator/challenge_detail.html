{% extends 'base.html' %}
{% load static %}

{% block title %}{{ task.title }}{% endblock %}

{% block extra_css %}
<!-- Base styles -->
<link rel="stylesheet" href="{% static 'css/tasks.css' %}?v=1.0">
<!-- Page specific styles -->
<link rel="stylesheet" href="{% static 'css/challenge.css' %}?v=1.1">
{% endblock %}

{% block content %}
<div class="page-wrapper" style="padding: 20px; max-width: 100%;">
    
    <div class="challenge-container">
        <!-- Left: Task Description -->
        <div class="task-sidebar">
            <a href="{% url 'simulator:task_list' %}" class="task-back-link">← Назад к списку</a>
            
            <h1 class="task-title">{{ task.title }}</h1>
            
            <div class="task-badge difficulty-{{ task.difficulty }}">
                {% if task.difficulty == 1 %}Novice{% elif task.difficulty == 2 %}Beginner{% else %}Hard{% endif %}
            </div>

            <div class="markdown-body task-description">
                {{ task.description|safe }}
            </div>

            {% if task.task_type == 'code' %}
            <div class="task-hint-box">
                <strong class="task-hint-label">Задача:</strong><br>
                Реализуйте функцию <code>{{ task.function_name }}</code>.
            </div>
            {% endif %}
        </div>

        <!-- Right: Editor or Quiz -->
        <div class="editor-area">
            {% if task.task_type == 'code' %}
                <!-- Code Editor Mode -->
                <div id="monaco-editor"></div>
                
                <div class="controls">
                    <button id="runBtn" class="run-btn">
                        <span>▶ Запустить код</span>
                    </button>
                </div>

                <div id="output" class="output-panel">
                    // Здесь будет результат выполнения...
                </div>
            
            {% else %}
                <!-- Quiz Mode -->
                <div class="quiz-wrapper">
                    <div class="quiz-container-inner">
                        <h2 class="quiz-header">Проверка знаний</h2>
                        
                        <div id="quiz-container">
                            <!-- Questions rendered via JS -->
                        </div>

                        <button id="submitQuizBtn" class="submit-quiz-btn">
                            Отправить ответы
                        </button>
                        
                        <div id="quiz-result" class="quiz-result-message"></div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

</div>

<!-- Hidden Inputs (Data Transfer) -->
<input type="hidden" id="initial-code" value="{{ previous_code|escape }}">
<input type="hidden" id="task-slug" value="{{ task.slug }}">
<input type="hidden" id="task-type" value="{{ task.task_type }}">

<!-- Safe JSON Data Transfer -->
{{ task.test_input|json_script:"quiz-data" }}

{% endblock %}

{% block extra_js %}
<!-- Monaco Loader -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
<!-- Page Logic -->
<script src="{% static 'js/challenge.js' %}?v=1.1"></script>
{% endblock %}
