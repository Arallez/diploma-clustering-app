{% extends 'base.html' %}

{% block title %}K-Means Simulator{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/simulator.css">
{% endblock %}

{% block content %}
<!-- Vue App Wrapper -->
{% verbatim %}
<div id="app">
    
    <nav class="navbar">
        <h1><div class="logo-icon"></div> ML Simulator</h1>
        <div class="nav-links">
            <a href="/" class="nav-item">Home</a>
            <a href="/simulator/" class="nav-item active">Simulator</a>
            <a href="/simulator/tasks/" class="nav-item">Course</a>
        </div>
    </nav>

    <div class="layout">
        <!-- Sidebar Controls -->
        <aside class="sidebar">
            <div class="control-group">
                <span class="control-label">Algorithm</span>
                <select class="cluster-input full-width">
                    <option>K-Means Clustering</option>
                    <option disabled>DBSCAN (Coming Soon)</option>
                </select>
            </div>

            <div class="control-group">
                <span class="control-label">Clusters (K)</span>
                <div class="k-controls">
                    <button class="btn btn-outline" @click="k > 1 ? k-- : null">-</button>
                    <input type="number" v-model="k" class="cluster-input" min="1" max="10">
                    <button class="btn btn-outline" @click="k < 10 ? k++ : null">+</button>
                </div>
            </div>

            <div class="control-group">
                <span class="control-label">Actions</span>
                <button class="btn btn-outline" @click="clearPoints">Clear Board</button>
                <button class="btn" @click="runAlgorithm" :disabled="points.length === 0 || isRunning">
                    {{ isRunning ? 'Processing...' : 'Run Algorithm' }}
                </button>
            </div>

            <div class="help-box">
                <strong>üí° How to use:</strong><br>
                1. Click anywhere on the empty graph area to add points.<br>
                2. Select number of clusters (K).<br>
                3. Press "Run" to see step-by-step clustering.
            </div>
        </aside>

        <!-- Main Workspace -->
        <main class="workspace">
            
            <!-- Info Chips -->
            <div class="stats-bar">
                <div class="stat-chip">Points: <span class="stat-value">{{ points.length }}</span></div>
                <div class="stat-chip">K-Value: <span class="stat-value">{{ k }}</span></div>
                <div class="stat-chip">Total Steps: <span class="stat-value">{{ history.length ? history.length : 0 }}</span></div>
            </div>

            <!-- Visualization -->
            <div class="graph-card">
                <div id="plot" @click="handleCanvasClick"></div>
            </div>

            <!-- Step Player -->
            <transition name="fade">
                <div class="step-control" v-if="history.length > 0">
                    <button class="btn btn-outline" @click="setStep(0)">‚èÆ</button>
                    <button class="btn btn-outline" @click="prevStep">‚óÄ</button>
                    
                    <div class="slider-container">
                        <span class="step-label align-right">{{ currentStep }}</span>
                        <input type="range" min="0" :max="history.length - 1" v-model.number="currentStep">
                        <span class="step-label">{{ history.length - 1 }}</span>
                    </div>

                    <button class="btn btn-outline" @click="nextStep">‚ñ∂</button>
                    <button class="btn btn-outline" @click="setStep(history.length - 1)">‚è≠</button>
                </div>
            </transition>

        </main>
    </div>

</div>
{% endverbatim %}
{% endblock %}

{% block extra_js %}
<!-- Plotly.js -->
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<!-- Vue.js 3 -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<!-- –ù–∞—à —Å–∏–º—É–ª—è—Ç–æ—Ä -->
<script src="/static/js/simulator.js"></script>
<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Vue-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    window.initSimulatorApp().mount('#app');
</script>
{% endblock %}