<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Challenge: {{ task.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/base.css">
  <link rel="stylesheet" href="/static/css/simulator.css">
  <link rel="stylesheet" href="/static/css/challenge.css">
</head>
<body>

<div id="app">
  <!-- Navbar removed, using base.html nav or external back link if standalone -->
  <nav class="navbar">
    <a href="/" class="navbar-brand">
        <div class="logo-icon"></div>
        <span class="brand-text">Clustering Trainer</span>
    </a>
    <div class="nav-links">
        <a href="/simulator/" class="nav-item">Simulator</a>
        <a href="/simulator/tasks/" class="nav-item active">Tasks</a>
        <a href="/encyclopedia/" class="nav-item">Knowledge Base</a>
    </div>
  </nav>

  <div class="main">
    <div class="task-panel">
      <div class="task-title">{% verbatim %}{{ task.title }}{% endverbatim %}</div>
      <div class="task-desc">
        {% autoescape off %}
        {{ task.description }}
        {% endautoescape %}
      </div>
      
      <div class="task-desc runtime-info">
        <p><i>Среда выполнения: Python 3.11 (Pyodide) + NumPy.</i></p>
      </div>
    </div>

    {% verbatim %}
    <div class="editor-panel">
      <div id="editor-container"></div>
      <div class="toolbar">
        <div class="status-msg">
            <span v-if="isRunning" class="loading">⏳ Выполняем...</span>
            <span v-if="resultStatus === 'success'" class="success">✅ {{ resultMessage }}</span>
            <span v-if="resultStatus === 'error'" class="error">❌ {{ resultMessage }}</span>
        </div>
        <button class="btn btn-reset" @click="resetCode">Сброс</button>
        <button class="btn btn-run" @click="runCode" :disabled="!isPyodideReady || isRunning">
          {{ isPyodideReady ? '▶ Проверить' : 'Загрузка...' }}
        </button>
      </div>
    </div>
    {% endverbatim %}

  </div>
</div>

<!-- Внешние библиотеки -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>

<!-- Наш код -->
<script src="/static/js/challenge.js"></script>
<script>
    // Передаём данные из Django в JavaScript
    const taskData = {
        slug: "{{ task.slug }}",
        title: "{{ task.title }}",
        function_name: "{{ task.function_name }}",
        initial_code: `{{ task.initial_code|escapejs }}`,
        test_input: {{ task.test_input|safe }}
    };

    // Инициализация Vue-приложения
    window.initChallengeApp(taskData).mount('#app');
</script>

</body>
</html>