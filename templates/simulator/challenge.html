{% extends 'base.html' %}
{% load static %}

{% block title %}Challenge: {{ task.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/simulator.css' %}">
<link rel="stylesheet" href="{% static 'css/challenge.css' %}">
{% endblock %}

{% block content %}
<!-- Vue App Wrapper -->
<div id="app" class="challenge-page">
  <!-- Navbar removed (handled by base.html) -->

  <div class="main">
    <div class="task-panel">
      <div class="task-title">{{ task.title }}</div>
      <div class="task-desc">
        {% autoescape off %}
        {{ task.description }}
        {% endautoescape %}
      </div>
      
      <div class="task-desc runtime-info">
        <p><i>Среда выполнения: Python 3.11 (Pyodide) + NumPy.</i></p>
      </div>
    </div>

    {% verbatim %}
    <div class="editor-panel">
      <div id="editor-container"></div>
      <div class="toolbar">
        <div class="status-msg">
            <span v-if="isRunning" class="loading">⏳ Выполняем...</span>
            <span v-if="resultStatus === 'success'" class="success">✅ {{ resultMessage }}</span>
            <span v-if="resultStatus === 'error'" class="error">❌ {{ resultMessage }}</span>
        </div>
        <button class="btn btn-reset" @click="resetCode">Сброс</button>
        <button class="btn btn-run" @click="runCode" :disabled="!isPyodideReady || isRunning">
          {{ isPyodideReady ? '▶ Проверить' : 'Загрузка...' }}
        </button>
      </div>
    </div>
    {% endverbatim %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- External Libs -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>

<!-- Challenge Logic -->
<script src="{% static 'js/challenge.js' %}"></script>
<script>
    const taskData = {
        slug: "{{ task.slug }}",
        title: "{{ task.title }}",
        function_name: "{{ task.function_name }}",
        initial_code: `{{ task.initial_code|escapejs }}`,
        test_input: {{ task.test_input|safe }}
    };
    window.initChallengeApp(taskData).mount('#app');
</script>
{% endblock %}
