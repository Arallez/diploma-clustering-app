{% extends 'base.html' %}
{% load static %}

{% block title %}{{ material.title }}{% endblock %}

{% block extra_css %}
<!-- Custom styles for materials (No Bootstrap) -->
<link rel="stylesheet" href="{% static 'css/materials.css' %}">
{% endblock %}

{% block content %}
<div class="page-container">
    <nav class="breadcrumbs">
        <a href="{% url 'home' %}">Главная</a>
        <span>/</span>
        <a href="{% url 'materials_list' %}">Материалы</a>
        <span>/</span>
        <span style="color: #e2e8f0;">{{ material.title }}</span>
    </nav>
    
    <article class="content-panel">
        <header class="article-header">
            <h1 class="article-title">{{ material.title }}</h1>
            <div class="article-meta">
                Обновлено: {{ material.updated_at|date:"d F Y" }}
            </div>
        </header>
        
        <!-- Raw content hidden -->
        <div id="raw-content" style="display:none;">{{ material.content }}</div>
        
        <!-- Rendered Markdown Container -->
        <div id="rendered-content" class="markdown-body"></div>
    </article>
    
    <div class="page-actions">
        <a href="{% url 'materials_list' %}" class="btn btn-outline">← Назад к списку</a>
        <a href="{% url 'simulator:index' %}" class="btn btn-primary">Перейти в симулятор →</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const rawContent = document.getElementById('raw-content').innerText;
        const renderContainer = document.getElementById('rendered-content');
        
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        renderContainer.innerHTML = marked.parse(rawContent);
        
        if (window.MathJax && window.MathJax.typesetPromise) {
            window.MathJax.typesetPromise([renderContainer]);
        }
    });
</script>
{% endblock %}
