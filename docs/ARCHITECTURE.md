# 🏛️ Архитектура проекта

## Обзор

Проект построен на **островковой архитектуре** (Islands Architecture) — гибридном подходе между традиционным серверным рендерингом (SSR) и Single Page Application (SPA).

## Принцип работы

### Server-Side Rendering (Django)
Django отрисовывает HTML-страницы на сервере и отдает их клиенту готовыми. Это обеспечивает:
- ✅ Быструю первую отрисовку
- ✅ SEO-оптимизацию
- ✅ Работу без JavaScript

### Client-Side Interactivity (Vue.js Islands)
Vue.js "оживляет" только конкретные интерактивные компоненты на странице:
- **Симулятор** (`static/js/simulator.js`) — граф, добавление точек, визуализация кластеров
- **Редактор задач** (`static/js/challenge.js`) — Monaco Editor, выполнение Python-кода

Остальной контент остается статичным HTML.

## Диаграмма архитектуры

```
┌─────────────────────────────────────────────────┐
│                 Браузер                        │
│  ┌────────────────────────────────────────┐   │
│  │  HTML (Django Templates)              │   │
│  │  ┌──────────┐  ┌──────────┐           │   │
│  │  │ Vue Island│  │Vue Island│  Статика │   │
│  │  │ Simulator│  │Challenge │           │   │
│  │  └─────┬────┘  └────┬─────┘           │   │
│  └────────┼────────────┼─────────────────┘   │
└───────────┼────────────┼──────────────────────┘
            │            │
        Fetch API    Fetch API
            │            │
            ▼            ▼
┌─────────────────────────────────────────────────┐
│           Django REST Framework API             │
│  ┌──────────────┐      ┌─────────────────┐    │
│  │ RunKMeans    │      │ CheckSolution   │    │
│  │ Endpoint     │      │ Endpoint        │    │
│  └──────┬───────┘      └────────┬────────┘    │
│         │                       │             │
│         ▼                       ▼             │
│  ┌─────────────┐        ┌─────────────┐      │
│  │ KMeans      │        │   Task      │      │
│  │ Engine      │        │   Model     │      │
│  │ (Sklearn)   │        │  (SQLite)   │      │
│  └─────────────┘        └─────────────┘      │
└─────────────────────────────────────────────────┘
```

## Поток данных

### Пример: Запуск алгоритма K-Means

1. **Пользователь кликает "Run Algorithm"** в Vue-компоненте
2. **Vue.js отправляет POST-запрос** на `/simulator/api/run-kmeans/`
3. **Django принимает запрос** в `views.RunKMeans`
4. **KMeansEngine** запускает Scikit-learn пошагово
5. **Сервер возвращает JSON** с историей центроидов и меток
6. **Vue.js обновляет график** через Plotly.js
7. **Пользователь видит анимацию** кластеризации

## Структура файлов

```
diploma-clustering-app/
├── apps/
│   └── simulator/
│       ├── engine.py         # Логика K-Means
│       ├── models.py         # Модели БД
│       ├── views.py          # API + страницы
│       └── urls.py           # Маршруты
├── templates/
│   ├── base.html            # Базовый шаблон
│   └── simulator/
│       ├── index.html       # Симулятор
│       ├── challenge.html   # Редактор задач
│       └── task_list.html   # Список заданий
├── static/
│   ├── js/
│   │   ├── simulator.js     # Vue-остров симулятора
│   │   └── challenge.js     # Vue-остров редактора
│   └── css/
│       └── base.css         # Глобальные стили
└── config/
    ├── settings.py          # Настройки
    └── urls.py              # Корневые маршруты
```

## Технологический стек

### Backend
- **Django 4.2** — веб-фреймворк
- **Django REST Framework** — API
- **Scikit-learn** — алгоритмы ML
- **SQLite** — база данных

### Frontend
- **Vue.js 3 (CDN)** — островки интерактивности
- **Plotly.js** — графики
- **Monaco Editor** — редактор кода
- **Pyodide** — Python в браузере (WebAssembly)

### Инфраструктура
- **Git** — версионирование
- **GitHub** — хостинг кода
- Без Docker/CI/CD (упрощенный деплой)

## Преимущества архитектуры

| Преимущество | Описание |
|--------------|----------|
| 🚀 **Быстрый старт** | Нет сборщиков (Webpack/Vite) |
| 📦 **Простой деплой** | Один сервер, одна БД |
| 🔍 **SEO** | HTML рендерится на сервере |
| ♿ **Доступность** | Работает без JS (частично) |
| 🧩 **Модульность** | Легко добавить новые островки |
| 🎓 **Обучение** | Понятная структура для диплома |

## Недостатки

- ❌ Нет горячей перезагрузки (Hot Module Replacement)
- ❌ Ручная синхронизация состояния между островками
- ❌ Дублирование кода при большом количестве компонентов

## Альтернативные архитектуры

### Для масштабирования
Если проект вырастет, рассмотрите:

1. **Full SPA** (Vue Router + Vuex)
   - Отдельный фронтенд-репозиторий
   - Django только как API
   - Деплой на Vercel/Netlify

2. **Nuxt.js + Django**
   - SSR через Nuxt
   - Django как headless CMS

3. **Микрофронтенды**
   - Каждый остров — отдельное приложение
   - Module Federation (Webpack 5)

## Безопасность

- ✅ CSRF-токены для форм
- ✅ Код Python выполняется в браузере (Pyodide), не на сервере
- ✅ Валидация входных данных в Django
- ⚠️ Нет rate limiting (добавить в продакшен)
- ⚠️ SECRET_KEY в `.env` (не коммитить!)

## Производительность

### Оптимизации
- CDN для библиотек (Vue, Plotly)
- Минификация статики (в продакшене)
- Кеширование через Django Cache Framework
- Индексы БД на часто запрашиваемых полях

### Узкие места
- Scikit-learn синхронный (блокирует при больших данных)
- SQLite не подходит для конкурентной записи
- Pyodide загружается ~5 секунд

## Деплой

### Development
```bash
python manage.py runserver
```

### Production (example)
```bash
# Gunicorn + Nginx
gunicorn config.wsgi:application --bind 0.0.0.0:8000
```

Подробнее: `docs/DEPLOY.md` (создать при необходимости)